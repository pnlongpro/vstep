# üìö Module 02: Practice & Learning

> **Module luy·ªán t·∫≠p 4 k·ªπ nƒÉng VSTEP**
> 
> File: `02-MODULE-PRACTICE-LEARNING.md`  
> Version: 1.0  
> Last Updated: 15/12/2024

---

## üìë M·ª•c l·ª•c

- [1. Gi·ªõi thi·ªáu module](#1-gi·ªõi-thi·ªáu-module)
- [2. Danh s√°ch ch·ª©c nƒÉng](#2-danh-s√°ch-ch·ª©c-nƒÉng)
- [3. Ph√¢n t√≠ch m√†n h√¨nh UI](#3-ph√¢n-t√≠ch-m√†n-h√¨nh-ui)
- [4. User Flow Diagrams](#4-user-flow-diagrams)
- [5. Sequence Diagrams](#5-sequence-diagrams)
- [6. Database Design](#6-database-design)
- [7. API Endpoints](#7-api-endpoints)
- [8. Business Rules](#8-business-rules)

---

## 1. Gi·ªõi thi·ªáu module

### 1.1. M·ª•c ƒë√≠ch
Module Practice & Learning l√† module c·ªët l√µi c·ªßa VSTEPRO, cung c·∫•p:
- **Luy·ªán t·∫≠p 4 k·ªπ nƒÉng**: Reading, Listening, Writing, Speaking
- **2 ch·∫ø ƒë·ªô**: Part Practice (luy·ªán theo ph·∫ßn) v√† Full Test (b√†i thi ƒë·∫ßy ƒë·ªß)
- **Ch·∫•m ƒëi·ªÉm t·ª± ƒë·ªông**: Reading v√† Listening
- **Ch·∫•m AI**: Writing v√† Speaking v·ªõi feedback chi ti·∫øt
- **Auto-save**: L∆∞u ti·∫øn tr√¨nh m·ªói 10 gi√¢y
- **L·ªãch s·ª≠**: L∆∞u t·∫•t c·∫£ b√†i ƒë√£ l√†m

### 1.2. Vai tr√≤ s·ª≠ d·ª•ng

**Student (H·ªçc vi√™n)**:
- Ch·ªçn k·ªπ nƒÉng luy·ªán t·∫≠p
- Ch·ªçn ch·∫ø ƒë·ªô (Part/Full Test)
- Browse danh s√°ch b√†i t·∫≠p
- L√†m b√†i t·∫≠p
- Xem k·∫øt qu·∫£ v√† gi·∫£i th√≠ch
- Review b√†i ƒë√£ l√†m
- Bookmark c√¢u h·ªèi

**Teacher (Gi√°o vi√™n)**:
- Preview b√†i t·∫≠p
- S·ª≠ d·ª•ng ƒë·ªÉ chu·∫©n b·ªã gi·∫£ng d·∫°y
- T·∫•t c·∫£ quy·ªÅn c·ªßa Student

**Admin**:
- T·∫•t c·∫£ quy·ªÅn c·ªßa Teacher
- Qu·∫£n l√Ω n·ªôi dung b√†i t·∫≠p

### 1.3. C·∫•u tr√∫c 4 k·ªπ nƒÉng theo VSTEP

#### **Reading (ƒê·ªçc hi·ªÉu)**
- **Part 1**: ƒêi·ªÅn t·ª´ v√†o ch·ªó tr·ªëng (10 c√¢u)
- **Part 2**: ƒê·ªçc ƒëo·∫°n vƒÉn ng·∫Øn v√† tr·∫£ l·ªùi c√¢u h·ªèi (10 c√¢u)
- **Part 3**: ƒê·ªçc ƒëo·∫°n vƒÉn d√†i v√† tr·∫£ l·ªùi c√¢u h·ªèi (20 c√¢u)
- **T·ªïng**: 40 c√¢u, 60 ph√∫t

#### **Listening (Nghe hi·ªÉu)**
- **Part 1**: Nghe v√† ch·ªçn ƒë√°p √°n ƒë√∫ng - H·ªôi tho·∫°i ng·∫Øn (8 c√¢u)
- **Part 2**: Nghe v√† ch·ªçn ƒë√°p √°n ƒë√∫ng - Monologue (7 c√¢u)
- **Part 3**: Nghe v√† ch·ªçn ƒë√°p √°n ƒë√∫ng - H·ªôi tho·∫°i d√†i ho·∫∑c lecture (20 c√¢u)
- **T·ªïng**: 35 c√¢u, ~40 ph√∫t

#### **Writing (Vi·∫øt)**
- **Task 1**: Vi·∫øt email/th∆∞ (√≠t nh·∫•t 120 t·ª´, 20 ph√∫t)
- **Task 2**: Vi·∫øt essay (√≠t nh·∫•t 250 t·ª´, 40 ph√∫t)
- **T·ªïng**: 2 tasks, 60 ph√∫t

#### **Speaking (N√≥i)**
- **Part 1**: Interview - Gi·ªõi thi·ªáu b·∫£n th√¢n (3 ph√∫t)
- **Part 2**: Long turn - N√≥i v·ªÅ ch·ªß ƒë·ªÅ (1 ph√∫t chu·∫©n b·ªã, 2 ph√∫t n√≥i)
- **Part 3**: Discussion - Th·∫£o lu·∫≠n (4 ph√∫t)
- **T·ªïng**: 3 parts, ~12 ph√∫t

### 1.4. Ph·∫°m vi module
- Practice Home (ch·ªçn k·ªπ nƒÉng)
- Mode Selection (Part/Full Test)
- Practice List (danh s√°ch b√†i t·∫≠p)
- Exercise Interface (l√†m b√†i)
- Result Page (xem k·∫øt qu·∫£)
- History (l·ªãch s·ª≠ l√†m b√†i)

---

## 2. Danh s√°ch ch·ª©c nƒÉng

### 2.1. Ch·ª©c nƒÉng ch√≠nh

#### A. Ch·ªçn k·ªπ nƒÉng luy·ªán t·∫≠p

**M√¥ t·∫£**: H·ªçc vi√™n ch·ªçn 1 trong 4 k·ªπ nƒÉng ƒë·ªÉ luy·ªán t·∫≠p

**Component**: `PracticeHome.tsx`

**Options**:
1. **Reading Practice** (Luy·ªán ƒë·ªçc)
   - Icon: Book
   - Color: Blue
   - Navigate to: Reading Practice

2. **Listening Practice** (Luy·ªán nghe)
   - Icon: Headphones
   - Color: Purple
   - Navigate to: Listening Practice

3. **Writing Practice** (Luy·ªán vi·∫øt)
   - Icon: PenTool
   - Color: Green
   - Navigate to: Writing Practice

4. **Speaking Practice** (Luy·ªán n√≥i)
   - Icon: Mic
   - Color: Orange
   - Navigate to: Speaking Practice

**Business Logic**:
1. Display 4 skill cards
2. Show quick stats for each skill (s·ªë b√†i ƒë√£ l√†m, avg score)
3. Click card ‚Üí Navigate to Mode Selection

---

#### B. Ch·ªçn ch·∫ø ƒë·ªô luy·ªán t·∫≠p

**M√¥ t·∫£**: Ch·ªçn gi·ªØa Part Practice v√† Full Test

**Component**: `ModeSelectionModal.tsx`

**Modes**:

**1. Part Practice (L√†m theo ph·∫ßn)**:
- Luy·ªán t·ª´ng ph·∫ßn ri√™ng bi·ªát
- Th·ªùi gian linh ho·∫°t ho·∫∑c theo chu·∫©n
- Ph√π h·ª£p: Luy·ªán t·∫≠p k·ªπ nƒÉng c·ª• th·ªÉ
- Example (Reading):
  - Part 1 only (10 c√¢u)
  - Part 2 only (10 c√¢u)
  - Part 3 only (20 c√¢u)

**2. Full Test (L√†m b·ªô ƒë·ªÅ ƒë·∫ßy ƒë·ªß)**:
- L√†m t·∫•t c·∫£ c√°c ph·∫ßn li√™n ti·∫øp
- Timer theo chu·∫©n VSTEP
- Ph√π h·ª£p: Thi th·ª≠, ƒë√°nh gi√° nƒÉng l·ª±c
- Example (Reading):
  - Part 1 + Part 2 + Part 3 (40 c√¢u, 60 ph√∫t)

**Business Logic**:
1. Show modal with 2 options
2. Click "Part Practice" ‚Üí Show Part Selection Modal
3. Click "Full Test" ‚Üí Navigate to Practice List (full test mode)

---

#### C. Ch·ªçn ph·∫ßn luy·ªán t·∫≠p (Part Practice)

**M√¥ t·∫£**: Ch·ªçn ph·∫ßn c·ª• th·ªÉ ƒë·ªÉ luy·ªán (khi ch·ªçn Part Practice)

**Component**: `PartSelectionModal.tsx`

**Example cho Reading**:
- [ ] Part 1: ƒêi·ªÅn t·ª´ v√†o ch·ªó tr·ªëng (10 c√¢u)
- [ ] Part 2: ƒê·ªçc ƒëo·∫°n vƒÉn ng·∫Øn (10 c√¢u)
- [ ] Part 3: ƒê·ªçc ƒëo·∫°n vƒÉn d√†i (20 c√¢u)

**Features**:
- Multiple selection (c√≥ th·ªÉ ch·ªçn nhi·ªÅu part)
- Show estimated time
- Show number of questions
- Button: "Ti·∫øp t·ª•c"

**Business Logic**:
1. User selects part(s)
2. Calculate total questions and time
3. Click "Ti·∫øp t·ª•c" ‚Üí Navigate to Practice List with selected parts

---

#### D. Browse danh s√°ch b√†i t·∫≠p

**M√¥ t·∫£**: Xem danh s√°ch b√†i t·∫≠p c√≥ s·∫µn

**Component**: `PracticeList.tsx`

**Display**:
- Grid/List of exercises
- Each exercise card shows:
  - Title (e.g., "Reading Full Test - ƒê·ªÅ s·ªë 1")
  - Level (A2/B1/B2/C1)
  - Type (Part 1/Part 2/Full Test)
  - Number of questions
  - Estimated time
  - Difficulty (Easy/Medium/Hard)
  - Status:
    - Not started (ch∆∞a l√†m)
    - In progress (ƒëang l√†m)
    - Completed (ƒë√£ l√†m) + score
  - Button: "B·∫Øt ƒë·∫ßu" / "Ti·∫øp t·ª•c" / "L√†m l·∫°i"

**Features**:
- **Filter**:
  - By level (A2/B1/B2/C1)
  - By type (Part 1/2/3, Full Test)
  - By status (All/Not started/In progress/Completed)
  
- **Sort**:
  - Newest first
  - Oldest first
  - Difficulty: Easy ‚Üí Hard
  - Difficulty: Hard ‚Üí Easy

- **Search**:
  - Search by title
  - Real-time filter

**Business Logic**:
1. Fetch exercises based on:
   - Skill (reading/listening/writing/speaking)
   - Mode (part/fulltest)
   - Selected parts (if part mode)
2. Filter and sort
3. Show status based on user history
4. Click exercise ‚Üí Navigate to Exercise Interface

---

#### E. L√†m b√†i t·∫≠p (Exercise Interface)

**M√¥ t·∫£**: Giao di·ªán l√†m b√†i t·∫≠p cho t·ª´ng k·ªπ nƒÉng

**Components**:
- `ReadingPractice.tsx` ‚Üí `ReadingExercise.tsx`
- `ListeningPractice.tsx` ‚Üí `ListeningExercise.tsx`
- `WritingPractice.tsx` ‚Üí `WritingExercise.tsx`
- `SpeakingPractice.tsx` ‚Üí `SpeakingExercise.tsx`

**Common Features**:

**1. Timer**:
- Countdown timer
- Warning khi c√≤n 5 ph√∫t
- Auto-submit khi h·∫øt gi·ªù
- C√≥ th·ªÉ t·∫Øt timer (practice mode)

**2. Progress Tracker**:
- Question navigator (c√¢u h·ªèi navigation)
- Hi·ªÉn th·ªã c√¢u ƒë√£ l√†m / ch∆∞a l√†m
- Bookmarked questions (ƒë√°nh d·∫•u)
- Jump to question

**3. Auto-save**:
- Save every 10 seconds
- Save to localStorage first
- Sync to server when online
- Restore on reload

**4. Submit**:
- Button "N·ªôp b√†i" (always visible)
- Confirmation modal tr∆∞·ªõc khi n·ªôp
- Disable back button sau khi n·ªôp

**Skill-specific Features**:

**Reading Exercise**:
- **Layout**: 2 columns (passage | questions)
- **Passage**:
  - Scrollable text
  - Highlight text tool
  - Zoom in/out
- **Questions**:
  - Multiple choice (A/B/C/D)
  - Radio buttons
  - Clear answer button
- **Navigation**:
  - Previous/Next buttons
  - Question number navigator

**Listening Exercise**:
- **Audio Player**:
  - Play/Pause
  - Volume control
  - Playback speed (0.75x, 1x, 1.25x)
  - Replay limit (1-2 times per audio)
- **Questions**:
  - Multiple choice
  - Can answer while listening
- **Parts**:
  - Part 1-3 play sequentially
  - Cannot replay previous part

**Writing Exercise**:
- **Task 1**:
  - Text editor (rich text)
  - Word counter
  - Time: 20 minutes
  - Min words: 120
  
- **Task 2**:
  - Text editor
  - Word counter  
  - Time: 40 minutes
  - Min words: 250

- **Tools**:
  - Spell check
  - Grammar suggestions (optional)
  - Save draft
  - Templates (optional)

**Speaking Exercise**:
- **Part 1 (Interview)**:
  - Display questions one by one
  - Record answer for each
  - Time per question: 1 minute

- **Part 2 (Long turn)**:
  - Preparation: 1 minute (show topic)
  - Recording: 2 minutes
  - Cannot re-record

- **Part 3 (Discussion)**:
  - Questions about Part 2 topic
  - Record answers
  - Time: 4 minutes total

- **Recording**:
  - Audio level meter
  - Test microphone
  - Record/Stop/Replay
  - Upload to server

**Business Logic**:
1. Load exercise data
2. Check if has saved progress ‚Üí Restore or start fresh
3. Start timer (if enabled)
4. User answers questions
5. Auto-save every 10 seconds
6. Submit:
   - Validate all answers (warning if unanswered)
   - Stop timer
   - Save final answers
   - Call grading API
   - Navigate to Result Page

---

#### F. Xem k·∫øt qu·∫£ (Result Page)

**M√¥ t·∫£**: Hi·ªÉn th·ªã ƒëi·ªÉm s·ªë v√† review b√†i l√†m

**Components**:
- `ReadingResult.tsx`
- `ListeningResult.tsx`
- `WritingResult.tsx`
- `SpeakingResult.tsx`

**Common Sections**:

**1. Score Summary**:
- Total score (band score 0-10)
- Percentage correct
- Time taken
- Visual: Circle progress bar

**2. Performance Breakdown**:
- Score by part
- Chart visualization
- Strengths/Weaknesses

**3. Answer Review** (Reading/Listening):
- Question-by-question review
- Show:
  - Question text
  - Your answer (highlight red if wrong, green if correct)
  - Correct answer
  - Explanation
- Filter:
  - All questions
  - Correct only
  - Incorrect only

**4. AI Feedback** (Writing/Speaking):
- Overall band score (0-10)
- Criteria scores:
  - Task Achievement/Response
  - Coherence and Cohesion
  - Lexical Resource
  - Grammatical Range and Accuracy
  - (Speaking): Pronunciation and Fluency
- Detailed feedback:
  - Strengths (what you did well)
  - Weaknesses (areas to improve)
  - Specific suggestions
  - Sample improvements

**5. Actions**:
- Save result
- Share result
- Redo exercise
- Practice similar level
- Back to Practice List

**Skill-specific Features**:

**Reading/Listening Result**:
- Instant scoring (automatic)
- Show correct/incorrect immediately
- Explanation for each answer
- Statistics:
  - Accuracy by part
  - Common mistake types

**Writing Result**:
- AI grading (takes ~30 seconds)
- Show writing with highlights:
  - Grammar errors (red underline)
  - Vocabulary suggestions (blue)
  - Structure issues (yellow)
- Band scores for each criterion
- Detailed feedback per task
- Sample essays (same score range)

**Speaking Result**:
- AI grading (takes ~1-2 minutes)
- Audio playback of your recording
- Transcript (if available)
- Pronunciation analysis:
  - Problem sounds
  - Intonation issues
- Fluency analysis:
  - Speaking rate
  - Pause frequency
  - Hesitations
- Suggestions for improvement

**Business Logic**:
1. Receive exercise_id + submission_id from submit
2. For Reading/Listening:
   - Calculate score immediately
   - Show results
3. For Writing/Speaking:
   - Show loading state "ƒêang ch·∫•m b√†i..."
   - Poll API every 5 seconds
   - When ready, display AI feedback
4. Save result to history
5. Unlock badges if achieved
6. Update statistics

---

#### G. Xem l·ªãch s·ª≠ l√†m b√†i

**M√¥ t·∫£**: Xem t·∫•t c·∫£ b√†i ƒë√£ l√†m

**Component**: `History.tsx`

**Display**:
- Table/List of submissions
- Columns:
  - Date
  - Skill (icon)
  - Exercise name
  - Type (Part/Full Test)
  - Score
  - Time taken
  - Status (Completed/In progress)
  - Actions (View result, Redo)

**Features**:
- **Filter**:
  - By skill (Reading/Listening/Writing/Speaking)
  - By type (Part/Full Test)
  - By date range
  - By score range

- **Sort**:
  - Recent first (default)
  - Oldest first
  - Highest score
  - Lowest score

- **Search**:
  - Search by exercise name

- **Pagination**:
  - 20 items per page
  - Load more / Page numbers

**Actions**:
- **View Result**: Open Result Page
- **Redo**: Start exercise again
- **Delete**: Remove from history (confirm)

**Business Logic**:
1. Fetch user's exercise history
2. Filter and sort
3. Display paginated list
4. Click "View Result" ‚Üí Navigate to Result Page with submission_id
5. Click "Redo" ‚Üí Navigate to Exercise Interface with fresh state

---

### 2.2. Ch·ª©c nƒÉng ph·ª•

#### A. Bookmark c√¢u h·ªèi

**Feature**: ƒê√°nh d·∫•u c√¢u kh√≥ ƒë·ªÉ review sau

**Usage**:
- Click bookmark icon on question
- Saved to user profile
- Access from "My Bookmarks" page

**Display**:
- List of bookmarked questions
- Group by skill
- Show question + answer + explanation

---

#### B. Note-taking

**Feature**: Ghi ch√∫ c√° nh√¢n cho c√¢u h·ªèi

**Usage**:
- Add note to specific question
- Private notes (ch·ªâ user nh√¨n th·∫•y)
- Sync across devices

---

#### C. Timer modes

**Modes**:
1. **Standard Timer**: ƒê·∫øm ng∆∞·ª£c theo chu·∫©n VSTEP
2. **Untimed**: Kh√¥ng gi·ªõi h·∫°n th·ªùi gian
3. **Custom Timer**: T·ª± set th·ªùi gian

---

#### D. Keyboard shortcuts

**Shortcuts**:
- `1-4`: Ch·ªçn ƒë√°p √°n A-D
- `‚Üí`: Next question
- `‚Üê`: Previous question
- `Ctrl+S`: Save progress
- `Ctrl+Enter`: Submit

---

#### E. Accessibility features

**Features**:
- Text-to-speech for questions
- Adjustable font size
- High contrast mode
- Keyboard navigation

---

### 2.3. Quy·ªÅn s·ª≠ d·ª•ng

| Ch·ª©c nƒÉng | Student | Teacher | Admin |
|-----------|---------|---------|-------|
| **Practice** | | | |
| Choose Skill | ‚úÖ | ‚úÖ | ‚úÖ |
| Choose Mode | ‚úÖ | ‚úÖ | ‚úÖ |
| Browse Exercises | ‚úÖ | ‚úÖ | ‚úÖ |
| Do Exercise | ‚úÖ | ‚úÖ | ‚úÖ |
| View Results | ‚úÖ | ‚úÖ | ‚úÖ |
| View History | ‚úÖ | ‚úÖ | ‚úÖ |
| Bookmark Questions | ‚úÖ | ‚úÖ | ‚úÖ |
| Add Notes | ‚úÖ | ‚úÖ | ‚úÖ |
| **Admin** | | | |
| Manage Exercises | ‚ùå | ‚ùå | ‚úÖ |
| View All Histories | ‚ùå | ‚ùå | ‚úÖ |

---

## 3. Ph√¢n t√≠ch m√†n h√¨nh UI

### 3.1. Practice Home

**File**: `/components/PracticeHome.tsx`

#### T√™n m√†n h√¨nh
**Practice Home / Trang luy·ªán t·∫≠p**

#### M·ª•c ƒë√≠ch
ƒêi·ªÉm b·∫Øt ƒë·∫ßu cho vi·ªác luy·ªán t·∫≠p, ch·ªçn k·ªπ nƒÉng

#### C√°c th√†nh ph·∫ßn UI

**Header**:
- Page title: "Luy·ªán t·∫≠p"
- Subtitle: "Ch·ªçn k·ªπ nƒÉng b·∫°n mu·ªën luy·ªán"

**Skills Grid** (2x2 tr√™n desktop):

**1. Reading Card**:
- Icon: Book (large, blue)
- Title: "Reading"
- Subtitle: "Luy·ªán ƒë·ªçc hi·ªÉu"
- Stats:
  - "X b√†i ƒë√£ l√†m"
  - "ƒêi·ªÉm TB: Y"
- Hover: Shadow lift
- Click: Navigate to Reading Practice

**2. Listening Card**:
- Icon: Headphones (large, purple)
- Title: "Listening"
- Subtitle: "Luy·ªán nghe hi·ªÉu"
- Stats: Same as Reading

**3. Writing Card**:
- Icon: PenTool (large, green)
- Title: "Writing"
- Subtitle: "Luy·ªán vi·∫øt"
- Stats: Same as Reading

**4. Speaking Card**:
- Icon: Mic (large, orange)
- Title: "Speaking"
- Subtitle: "Luy·ªán n√≥i"
- Stats: Same as Reading

**Special Section**:
- Card: "Thi th·ª≠ Random" (Module 03)
  - Icon: Shuffle
  - Description: "Thi th·ª≠ v·ªõi 4 ƒë·ªÅ ng·∫´u nhi√™n"
  - Button: "B·∫Øt ƒë·∫ßu thi th·ª≠"

**Quick Stats** (optional):
- Total exercises completed
- Total practice time
- Current streak

#### Ch·ª©c nƒÉng

1. Display 4 skill cards with stats
2. Fetch user's practice stats
3. Click skill card ‚Üí Navigate to skill practice
4. Click "Thi th·ª≠ Random" ‚Üí Navigate to Mock Exam

#### Lu·ªìng x·ª≠ l√Ω

```
User arrives at Practice Home
  ‚Üì
Fetch user's practice stats
  ‚Üì
Display 4 skill cards + stats
  ‚Üì
User clicks a skill card (e.g., Reading)
  ‚Üì
Navigate to Reading Practice page
  ‚Üì
Show Mode Selection Modal
```

---

### 3.2. Mode Selection Modal

**File**: `/components/ModeSelectionModal.tsx`

#### T√™n m√†n h√¨nh
**Mode Selection Modal**

#### M·ª•c ƒë√≠ch
Ch·ªçn ch·∫ø ƒë·ªô luy·ªán t·∫≠p: Part ho·∫∑c Full Test

#### C√°c th√†nh ph·∫ßn UI

**Modal Header**:
- Icon: Skill icon (Reading/Listening/Writing/Speaking)
- Title: "Ch·ªçn ch·∫ø ƒë·ªô luy·ªán t·∫≠p"
- Close button (X)

**Mode Options** (2 cards):

**Card 1: Part Practice**:
- Icon: PuzzlePiece
- Title: "L√†m theo ph·∫ßn"
- Description: "Luy·ªán t·ª´ng ph·∫ßn ri√™ng bi·ªát ƒë·ªÉ t·∫≠p trung k·ªπ nƒÉng c·ª• th·ªÉ"
- Features:
  - ‚úì Linh ho·∫°t th·ªùi gian
  - ‚úì T·∫≠p trung k·ªπ nƒÉng
  - ‚úì Ph√π h·ª£p √¥n t·∫≠p
- Button: "Ch·ªçn"

**Card 2: Full Test**:
- Icon: FileText
- Title: "L√†m b·ªô ƒë·ªÅ ƒë·∫ßy ƒë·ªß"
- Description: "L√†m t·∫•t c·∫£ c√°c ph·∫ßn li√™n ti·∫øp nh∆∞ thi th·∫≠t"
- Features:
  - ‚úì Timer theo chu·∫©n
  - ‚úì ƒê√°nh gi√° t·ªïng th·ªÉ
  - ‚úì Ph√π h·ª£p thi th·ª≠
- Button: "Ch·ªçn"

**Footer**:
- Link: "H∆∞·ªõng d·∫´n c√°ch l√†m b√†i" (open help modal)

#### Ch·ª©c nƒÉng

1. Show modal when user enters skill practice
2. Click "Part Practice" ‚Üí Show Part Selection Modal
3. Click "Full Test" ‚Üí Navigate to Practice List (fulltest mode)

---

### 3.3. Part Selection Modal

**File**: `/components/PartSelectionModal.tsx`

#### T√™n m√†n h√¨nh
**Part Selection Modal**

#### M·ª•c ƒë√≠ch
Ch·ªçn ph·∫ßn c·ª• th·ªÉ ƒë·ªÉ luy·ªán (khi ch·ªçn Part Practice)

#### C√°c th√†nh ph·∫ßn UI

**Modal Header**:
- Back button (‚Üê to Mode Selection)
- Title: "Ch·ªçn ph·∫ßn luy·ªán t·∫≠p"
- Subtitle: "Reading Practice"

**Part Checkboxes** (example cho Reading):

**Part 1 Checkbox**:
- [ ] Part 1: ƒêi·ªÅn t·ª´ v√†o ch·ªó tr·ªëng
- Details: "10 c√¢u ‚Ä¢ ~15 ph√∫t ‚Ä¢ C∆° b·∫£n"
- Icon: Check when selected

**Part 2 Checkbox**:
- [ ] Part 2: ƒê·ªçc ƒëo·∫°n vƒÉn ng·∫Øn
- Details: "10 c√¢u ‚Ä¢ ~20 ph√∫t ‚Ä¢ Trung b√¨nh"

**Part 3 Checkbox**:
- [ ] Part 3: ƒê·ªçc ƒëo·∫°n vƒÉn d√†i
- Details: "20 c√¢u ‚Ä¢ ~25 ph√∫t ‚Ä¢ N√¢ng cao"

**Summary**:
- Display when parts selected:
  - "ƒê√£ ch·ªçn: X ph·∫ßn"
  - "T·ªïng c√¢u h·ªèi: Y"
  - "Th·ªùi gian ∆∞·ªõc t√≠nh: Z ph√∫t"

**Footer**:
- Button: "H·ªßy" (secondary)
- Button: "Ti·∫øp t·ª•c" (primary, disabled khi ch∆∞a ch·ªçn part)

#### Ch·ª©c nƒÉng

1. Display part options with checkboxes
2. Multiple selection allowed
3. Update summary real-time
4. Click "Ti·∫øp t·ª•c" ‚Üí Navigate to Practice List with selected parts

---

### 3.4. Practice List

**File**: `/components/PracticeList.tsx`

#### T√™n m√†n h√¨nh
**Practice List / Danh s√°ch b√†i t·∫≠p**

#### M·ª•c ƒë√≠ch
Hi·ªÉn th·ªã danh s√°ch b√†i t·∫≠p c√≥ s·∫µn ƒë·ªÉ ch·ªçn

#### C√°c th√†nh ph·∫ßn UI

**Header**:
- Breadcrumb: "Luy·ªán t·∫≠p > Reading > Full Test"
- Title: "Ch·ªçn b√†i t·∫≠p"
- Subtitle: "Reading Full Test"

**Filters Bar**:
- **Level Filter**: Dropdown
  - All levels
  - A2
  - B1
  - B2
  - C1

- **Status Filter**: Dropdown
  - All
  - Not started
  - In progress
  - Completed

- **Sort**: Dropdown
  - Newest first
  - Oldest first
  - Easy to Hard
  - Hard to Easy

- **Search**: Input box
  - Icon: Search
  - Placeholder: "T√¨m b√†i t·∫≠p..."

**Exercise Cards Grid** (2 columns):

Each card:
- **Header**:
  - Title: "Reading Full Test - ƒê·ªÅ s·ªë 1"
  - Level badge: "B2" (colored)
  - Difficulty badge: "Medium" (yellow)

- **Content**:
  - Description (if any)
  - Stats:
    - üìù 40 questions
    - ‚è±Ô∏è 60 minutes
    - üìä Average score: 7.5/10

- **Status Indicator**:
  - Not started: Gray
  - In progress: Blue + "ƒêang l√†m d·ªü"
  - Completed: Green + "ƒêi·ªÉm: X/10"

- **Footer**:
  - Button:
    - Not started: "B·∫Øt ƒë·∫ßu" (primary)
    - In progress: "Ti·∫øp t·ª•c" (blue)
    - Completed: "L√†m l·∫°i" (secondary) + "Xem k·∫øt qu·∫£" (link)

**Empty State**:
- Icon: FileX
- Title: "Kh√¥ng t√¨m th·∫•y b√†i t·∫≠p"
- Message: "Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t√¨m ki·∫øm"

**Pagination**:
- Show: "Showing 1-20 of 50"
- Buttons: Previous | 1 2 3 ... 5 | Next

#### Ch·ª©c nƒÉng

1. **Load Exercises**:
   - Fetch based on skill + mode + parts
   - Apply filters and sort
   - Paginate results

2. **Filter & Sort**:
   - Real-time update on change
   - No page reload

3. **Search**:
   - Debounced search (500ms)
   - Search in title and description

4. **Status Tracking**:
   - Check if user has started/completed
   - Show appropriate button and status

5. **Start Exercise**:
   - Click "B·∫Øt ƒë·∫ßu" ‚Üí Navigate to Exercise Interface
   - Click "Ti·∫øp t·ª•c" ‚Üí Restore saved progress
   - Click "L√†m l·∫°i" ‚Üí Confirm ‚Üí Start fresh

#### Lu·ªìng x·ª≠ l√Ω

```
User arrives at Practice List
  ‚Üì
Load exercises based on:
  - Skill: reading
  - Mode: fulltest
  - Parts: all (if fulltest) or selected parts
  ‚Üì
Display exercises as cards
  ‚Üì
User filters/sorts/searches
  ‚Üì
Update display (client-side or API call)
  ‚Üì
User clicks "B·∫Øt ƒë·∫ßu" on an exercise
  ‚Üì
Navigate to Exercise Interface v·ªõi exercise_id
```

---

### 3.5. Reading Exercise Interface

**File**: `/components/reading/ReadingExercise.tsx`

#### T√™n m√†n h√¨nh
**Reading Exercise Interface**

#### M·ª•c ƒë√≠ch
Giao di·ªán l√†m b√†i ƒë·ªçc hi·ªÉu

#### C√°c th√†nh ph·∫ßn UI

**Top Bar**:
- Left:
  - Back button (‚Üê Exit - with confirm)
  - Exercise title: "Reading Full Test - ƒê·ªÅ s·ªë 1"
  
- Center:
  - Timer: "45:30" (countdown)
  - Warning icon khi < 5 ph√∫t (red)
  
- Right:
  - Auto-save indicator: "ƒê√£ l∆∞u l√∫c 10:30"
  - Submit button: "N·ªôp b√†i" (always visible)

**Main Content** (2-column layout):

**Left Column: Passage** (40% width):
- Header:
  - Part indicator: "Part 1 of 3"
  - Passage title (if any)
  
- Content:
  - Scrollable text
  - Line numbers (optional)
  - Highlight tool (select text ‚Üí highlight)
  
- Zoom controls:
  - A- | A | A+ (font size)

**Right Column: Questions** (60% width):
- Question Card:
  - Question number: "Question 1 of 40"
  - Question text
  - Options (A/B/C/D):
    - Radio buttons
    - Large click area
    - Keyboard support (1-4)
  - Bookmark icon (star)
  - Note icon (add note)
  
- Navigation:
  - Previous button
  - Next button
  - Question number navigator (bottom)

**Question Navigator** (sticky bottom):
- Grid of question numbers (1-40)
- Visual states:
  - Not answered: White
  - Answered: Blue
  - Current: Blue border
  - Bookmarked: Yellow star
- Click number ‚Üí Jump to question

**Submit Confirmation Modal**:
- Title: "N·ªôp b√†i?"
- Message: "B·∫°n ƒë√£ tr·∫£ l·ªùi X/40 c√¢u. B·∫°n c√≥ ch·∫Øc mu·ªën n·ªôp b√†i?"
- Warning: "Y c√¢u ch∆∞a tr·∫£ l·ªùi"
- Buttons:
  - "Quay l·∫°i" (secondary)
  - "N·ªôp b√†i" (primary, red)

#### Ch·ª©c nƒÉng

1. **Load Exercise**:
   - Fetch exercise data (passages, questions, answers)
   - Check if has saved progress
   - Restore or start fresh

2. **Timer**:
   - Start countdown from time limit
   - Update every second
   - Warning at 5 minutes
   - Auto-submit at 0:00

3. **Answer Question**:
   - Click option ‚Üí Select
   - Update local state
   - Visual feedback (blue highlight)
   - Update question navigator

4. **Navigate Questions**:
   - Click Previous/Next
   - Click question number in navigator
   - Keyboard arrows (‚Üê ‚Üí)

5. **Auto-save**:
   - Save to localStorage every 10 seconds
   - Save to server every 30 seconds (if online)
   - Show save indicator

6. **Bookmark**:
   - Click star icon
   - Mark question in navigator (yellow)
   - Save to user profile

7. **Submit**:
   - Click "N·ªôp b√†i"
   - Validate: Confirm if unanswered questions
   - Stop timer
   - Save final answers
   - Call grading API
   - Navigate to Result Page

#### Lu·ªìng x·ª≠ l√Ω

```
User starts Reading exercise
  ‚Üì
Load exercise data from API
  ‚Üì
Check if has saved progress:
  ‚îú‚îÄ Yes ‚Üí Restore answers + timer position
  ‚îî‚îÄ No ‚Üí Start fresh with full time
  ‚Üì
Display passage + first question
  ‚Üì
Start timer (if enabled)
  ‚Üì
[User reads passage]
  ‚Üì
[User answers questions]
  ‚îú‚îÄ Click option ‚Üí Select
  ‚îú‚îÄ Click Next ‚Üí Move to next question
  ‚îú‚îÄ Auto-save every 10s
  ‚îî‚îÄ Bookmark difficult questions
  ‚Üì
[User clicks "N·ªôp b√†i"]
  ‚Üì
Check answered questions:
  ‚îú‚îÄ All answered ‚Üí Direct submit
  ‚îî‚îÄ Some unanswered ‚Üí Show confirmation modal
      ‚îú‚îÄ "Quay l·∫°i" ‚Üí Stay in exercise
      ‚îî‚îÄ "N·ªôp b√†i" ‚Üí Continue
  ‚Üì
Stop timer
  ‚Üì
POST /api/exercises/{id}/submit
  ‚Üì
Backend:
  ‚îú‚îÄ Save submission
  ‚îú‚îÄ Calculate score (auto-grading)
  ‚îî‚îÄ Return result_id
  ‚Üì
Navigate to Result Page v·ªõi result_id
```

---

### 3.6. Writing Exercise Interface

**File**: `/components/writing/WritingExercise.tsx`

#### T√™n m√†n h√¨nh
**Writing Exercise Interface**

#### M·ª•c ƒë√≠ch
Giao di·ªán l√†m b√†i vi·∫øt

#### C√°c th√†nh ph·∫ßn UI

**Top Bar**: (Same as Reading)

**Main Content**:

**Task Tabs**:
- Tab 1: "Task 1" (active by default)
- Tab 2: "Task 2"

**Task 1 View**:

**Left Panel: Task Instructions** (30%):
- Task type: "Email/Letter Writing"
- Time limit: "20 minutes"
- Word count requirement: "At least 120 words"
- Task prompt (scrollable):
  ```
  You received an email from your English friend...
  Write a reply to your friend. In your email:
  - Answer their questions
  - Ask for more information
  - Suggest meeting time
  ```

**Right Panel: Editor** (70%):
- Rich text editor:
  - Bold, Italic, Underline
  - Lists (bullet, numbered)
  - Undo/Redo
  - Spell check (optional)
  
- Word counter (live):
  - "Current: 45 words"
  - Color: Red if < 120, Green if ‚â• 120
  
- Save draft button

**Task 2 View**: (Same structure)
- Task type: "Essay Writing"
- Time limit: "40 minutes"
- Word count: "At least 250 words"
- Task prompt:
  ```
  Some people think that...
  Discuss both views and give your opinion.
  ```

**Progress Indicator** (sticky):
- Task 1: 20 min | 120+ words | Status: Complete ‚úì
- Task 2: 40 min | 250+ words | Status: In progress
- Total time: 60 minutes

**Submit Requirements Check**:
- Before submit, validate:
  - Task 1: ‚â• 120 words ‚úì
  - Task 2: ‚â• 250 words ‚úó (150 words)
  - Warning: "Task 2 ch∆∞a ƒë·ªß s·ªë t·ª´ t·ªëi thi·ªÉu"

#### Ch·ª©c nƒÉng

1. **Timer per Task**:
   - Task 1: 20 minutes
   - Task 2: 40 minutes
   - Can switch between tasks freely
   - Total timer: 60 minutes

2. **Word Counter**:
   - Live count as user types
   - Highlight min requirement
   - Warning if under

3. **Auto-save**:
   - Save to localStorage every 10s
   - Save to server every 30s
   - Draft recovery on reload

4. **Switch Tasks**:
   - Click tab to switch
   - Progress saved for both tasks
   - Can work on either task in any order

5. **Submit**:
   - Validate word counts
   - Warn if under minimum
   - Can submit anyway (with penalty)
   - Upload to server
   - Send to AI grading
   - Navigate to Result Page (with loading state)

---

### 3.7. Speaking Exercise Interface

**File**: `/components/speaking/SpeakingExercise.tsx`

#### T√™n m√†n h√¨nh
**Speaking Exercise Interface**

#### M·ª•c ƒë√≠ch
Giao di·ªán l√†m b√†i n√≥i

#### C√°c th√†nh ph·∫ßn UI

**Pre-start: Microphone Test**:
- Title: "Ki·ªÉm tra microphone"
- Audio level meter (visual bars)
- Button: "Test recording"
- Playback test
- Button: "B·∫Øt ƒë·∫ßu b√†i thi" (when ready)

**Part 1: Interview** (3 minutes):

**Question Display**:
- Part indicator: "Part 1: Interview (Question 1 of 3)"
- Question text (large font):
  ```
  Tell me about yourself.
  Where are you from?
  What do you do?
  ```
- Timer: "2:45" remaining

**Recording Controls**:
- Audio level meter (real-time)
- Button: "B·∫Øt ƒë·∫ßu tr·∫£ l·ªùi" (Start recording)
- Button: "D·ª´ng l·∫°i" (Stop recording)
- Status: "ƒêang ghi √¢m..." (red dot)

**After Recording**:
- "Recording saved ‚úì"
- Playback button: "Nghe l·∫°i"
- Button: "Next question"

**Part 2: Long Turn** (3 minutes total):

**Preparation Phase** (1 minute):
- Title: "Preparation Time: 1:00"
- Topic card:
  ```
  Describe a place you like to visit.
  You should say:
  - Where it is
  - When you go there
  - What you do there
  - Why you like it
  ```
- Note-taking area (optional)
- Countdown: "0:45" remaining

**Recording Phase** (2 minutes):
- Title: "Speaking Time: 2:00"
- Topic card (still visible)
- Recording controls (auto-start)
- Cannot pause/stop (must record full 2 min)

**Part 3: Discussion** (4 minutes):
- Follow-up questions about Part 2 topic
- Multiple questions
- Record answer for each
- Can move between questions

**Submit**:
- Upload all recordings
- Processing: "ƒêang t·∫£i l√™n... X/Y files"
- Send to AI grading
- Navigate to Result Page

#### Ch·ª©c nƒÉng

1. **Microphone Test**:
   - Request mic permission
   - Test audio input
   - Show audio level
   - Test playback

2. **Recording**:
   - High quality audio (WAV/MP3)
   - Real-time level meter
   - Auto-save recordings
   - Upload to server

3. **Timer Control**:
   - Part 1: 3 min total (flexible per question)
   - Part 2: 1 min prep + 2 min speak (strict)
   - Part 3: 4 min total (flexible)

4. **Prevent Cheating**:
   - Cannot replay previous parts
   - Cannot re-record Part 2
   - Timer strictly enforced

5. **Upload**:
   - Compress audio files
   - Upload to file storage (S3)
   - Save file URLs to database
   - Send to AI grading queue

---

### 3.8. Result Page (Reading/Listening)

**File**: `/components/reading/ReadingResult.tsx`

#### T√™n m√†n h√¨nh
**Reading Result Page**

#### M·ª•c ƒë√≠ch
Hi·ªÉn th·ªã k·∫øt qu·∫£ v√† review b√†i l√†m

#### C√°c th√†nh ph·∫ßn UI

**Score Summary Card**:
- **Circle Progress** (center):
  - Score: "8.0/10"
  - Percentage: "85%"
  - Color: Green (good), Yellow (medium), Red (poor)
  
- **Stats**:
  - Correct: 34/40
  - Time taken: 45:30 / 60:00
  - Completion: 100%

- **Band Score Equivalent**:
  - "T∆∞∆°ng ƒë∆∞∆°ng VSTEP Band: 8.0"

**Performance Breakdown**:
- Chart: Bar chart by part
  - Part 1: 9/10 (90%)
  - Part 2: 8/10 (80%)
  - Part 3: 17/20 (85%)

- Analysis:
  - Strengths: "Part 1 - ƒêi·ªÅn t·ª´ v√†o ch·ªó tr·ªëng"
  - Weaknesses: "Part 2 - ƒê·ªçc ƒëo·∫°n vƒÉn ng·∫Øn"

**Answer Review**:

**Filter Tabs**:
- All questions (40)
- Correct (34) ‚úì
- Incorrect (6) ‚úó

**Question Cards** (list):

Each card:
- Question number + status icon (‚úì or ‚úó)
- Question text
- Passage excerpt (if relevant)
- Options (A/B/C/D):
  - Your answer: Highlighted (green if correct, red if wrong)
  - Correct answer: Highlighted green (if wrong)
- Explanation:
  - "ƒê√°p √°n ƒë√∫ng l√† C v√¨..."
  - Detailed explanation
  - Reference to passage

**Actions Footer**:
- Button: "L∆∞u k·∫øt qu·∫£" (Save to history)
- Button: "L√†m l·∫°i" (Redo exercise)
- Button: "Luy·ªán t∆∞∆°ng t·ª±" (Practice similar level)
- Button: "V·ªÅ danh s√°ch" (Back to Practice List)

#### Ch·ª©c nƒÉng

1. **Display Score**:
   - Calculate from submission
   - Show percentage and band score
   - Visual progress circle

2. **Breakdown Analysis**:
   - Score by part
   - Identify strengths/weaknesses
   - Chart visualization

3. **Answer Review**:
   - Show all questions with answers
   - Filter correct/incorrect
   - Detailed explanations
   - Highlight correct/wrong answers

4. **Actions**:
   - Save result to history
   - Redo exercise (confirm)
   - Find similar exercises
   - Navigate back

---

### 3.9. Result Page (Writing/Speaking with AI)

**File**: `/components/writing/WritingResult.tsx`

#### T√™n m√†n h√¨nh
**Writing Result Page (AI Grading)**

#### M·ª•c ƒë√≠ch
Hi·ªÉn th·ªã k·∫øt qu·∫£ ch·∫•m AI cho Writing/Speaking

#### C√°c th√†nh ph·∫ßn UI

**Loading State** (while AI grading):
- Animation: Spinner or progress bar
- Text: "ƒêang ch·∫•m b√†i b·∫±ng AI..."
- Sub-text: "Qu√° tr√¨nh n√†y c√≥ th·ªÉ m·∫•t 30-60 gi√¢y"
- Progress: "ƒêang ph√¢n t√≠ch Task 1... (50%)"

**Score Summary Card** (after grading):
- **Overall Band Score**: "7.5/10"
- **Circle Progress**: Visual score

**Criteria Scores** (4 criteria for Writing):

1. **Task Achievement** (Task Response):
   - Score: 7.5/10
   - Progress bar (75%)
   - Short description: "Good task response"

2. **Coherence and Cohesion**:
   - Score: 8.0/10
   - Progress bar (80%)

3. **Lexical Resource**:
   - Score: 7.0/10
   - Progress bar (70%)

4. **Grammatical Range and Accuracy**:
   - Score: 7.5/10
   - Progress bar (75%)

**AI Feedback Sections**:

**Overall Feedback**:
- Summary paragraph
- General comments
- Overall impression

**Strengths** (‚úì green):
- "Good use of paragraphing and structure"
- "Wide range of vocabulary related to the topic"
- "Clear arguments with supporting examples"

**Weaknesses** (‚úó red):
- "Some grammatical errors with complex sentences"
- "Limited use of cohesive devices"
- "Conclusion could be stronger"

**Detailed Feedback by Task**:

**Task 1**:
- Your writing (with highlights):
  - Grammar errors: Red underline
  - Vocabulary suggestions: Blue underline
  - Structure issues: Yellow highlight
  
- Specific feedback:
  - "Opening paragraph is clear and well-structured"
  - "Body paragraphs need better linking"
  - "Consider using more formal language"

- Suggestions:
  - Instead of "very good" ‚Üí "excellent" or "outstanding"
  - Instead of "I think" ‚Üí "In my opinion" or "It seems that"

**Sample Essay** (same score range):
- Title: "Sample Essay - Band 7.5"
- Full essay text
- Annotations highlighting good practices

**Actions**:
- Download result (PDF)
- Save to history
- Redo exercise
- Practice similar

#### Ch·ª©c nƒÉng

1. **AI Grading**:
   - Submit to AI API (OpenAI/Custom)
   - Poll for results every 5 seconds
   - Show loading state
   - Display results when ready

2. **Highlight Errors**:
   - Parse AI response
   - Highlight text with issues
   - Show tooltips on hover

3. **Show Feedback**:
   - Overall score
   - Criteria breakdown
   - Strengths/Weaknesses
   - Specific suggestions

4. **Sample Essays**:
   - Fetch samples in same score range
   - Display for comparison
   - Highlight good practices

---

## 4. User Flow Diagrams

### 4.1. Complete Practice Flow (Reading Example)

```
[Start] Student wants to practice Reading
  ‚Üì
Navigate to Practice Home
  ‚Üì
Click "Reading" card
  ‚Üì
Navigate to Reading Practice page
  ‚Üì
Show Mode Selection Modal
  ‚Üì
Student chooses mode:
  ‚îÇ
  ‚îú‚îÄ Part Practice:
  ‚îÇ   ‚îú‚îÄ Show Part Selection Modal
  ‚îÇ   ‚îú‚îÄ Student selects parts (e.g., Part 1 + Part 2)
  ‚îÇ   ‚îú‚îÄ Click "Ti·∫øp t·ª•c"
  ‚îÇ   ‚îî‚îÄ Navigate to Practice List v·ªõi parts=[1,2]
  ‚îÇ
  ‚îî‚îÄ Full Test:
      ‚îî‚îÄ Navigate to Practice List v·ªõi mode=fulltest
  ‚Üì
Practice List Page
  ‚Üì
Display exercises based on selection
  ‚Üì
Student filters/sorts/searches
  ‚Üì
Student clicks "B·∫Øt ƒë·∫ßu" on an exercise
  ‚Üì
Navigate to Reading Exercise Interface
  ‚Üì
Load exercise data
  ‚Üì
Check saved progress:
  ‚îú‚îÄ Has progress ‚Üí Restore answers + timer
  ‚îî‚îÄ No progress ‚Üí Start fresh
  ‚Üì
Display passage + questions
  ‚Üì
Start timer (if enabled)
  ‚Üì
[Student reads and answers questions]
  ‚îú‚îÄ Read passage
  ‚îú‚îÄ Answer questions (click options)
  ‚îú‚îÄ Navigate between questions
  ‚îú‚îÄ Bookmark difficult questions
  ‚îî‚îÄ Auto-save every 10 seconds
  ‚Üì
[Student clicks "N·ªôp b√†i"]
  ‚Üì
Show confirmation modal
  ‚Üì
Student confirms
  ‚Üì
Submit answers to API
  ‚Üì
Backend:
  ‚îú‚îÄ Save submission
  ‚îú‚îÄ Auto-grade (compare with correct answers)
  ‚îú‚îÄ Calculate score
  ‚îî‚îÄ Return result_id
  ‚Üì
Navigate to Result Page
  ‚Üì
Display score + review
  ‚Üì
[Student reviews answers]
  ‚îú‚îÄ View score summary
  ‚îú‚îÄ Check performance breakdown
  ‚îú‚îÄ Review each question
  ‚îî‚îÄ Read explanations
  ‚Üì
[Student chooses next action]
  ‚îú‚îÄ "L√†m l·∫°i" ‚Üí Redo exercise
  ‚îú‚îÄ "Luy·ªán t∆∞∆°ng t·ª±" ‚Üí Find similar
  ‚îî‚îÄ "V·ªÅ danh s√°ch" ‚Üí Back to list
  ‚Üì
[End] Practice session complete
```

### 4.2. Writing Practice with AI Grading Flow

```
[Start] Student practices Writing
  ‚Üì
... (same as Reading until Exercise Interface)
  ‚Üì
Writing Exercise Interface
  ‚Üì
Display Task 1 + Task 2 tabs
  ‚Üì
Start timer (60 minutes total)
  ‚Üì
[Student works on Task 1]
  ‚îú‚îÄ Read task prompt
  ‚îú‚îÄ Write in text editor
  ‚îú‚îÄ Word counter updates live
  ‚îú‚îÄ Auto-save every 10s
  ‚îî‚îÄ Switch to Task 2 when ready
  ‚Üì
[Student works on Task 2]
  ‚îú‚îÄ Same process as Task 1
  ‚îî‚îÄ Can switch back to Task 1 anytime
  ‚Üì
[Student clicks "N·ªôp b√†i"]
  ‚Üì
Validate word counts:
  ‚îú‚îÄ Task 1: ‚â• 120 words? ‚Üí Yes ‚úì
  ‚îî‚îÄ Task 2: ‚â• 250 words? ‚Üí No (200 words)
      ‚îî‚îÄ Show warning: "Task 2 ch∆∞a ƒë·ªß 250 t·ª´"
  ‚Üì
Student confirms submit anyway
  ‚Üì
Submit to API
  ‚Üì
Backend:
  ‚îú‚îÄ Save submission
  ‚îú‚îÄ Queue for AI grading
  ‚îî‚îÄ Return submission_id
  ‚Üì
Navigate to Result Page
  ‚Üì
Show loading state: "ƒêang ch·∫•m b√†i b·∫±ng AI..."
  ‚Üì
Poll API every 5 seconds
  ‚Üì
[AI Grading Process]
  ‚îú‚îÄ Send to OpenAI API
  ‚îú‚îÄ Analyze Task 1
  ‚îú‚îÄ Analyze Task 2
  ‚îú‚îÄ Calculate scores for 4 criteria
  ‚îú‚îÄ Generate feedback
  ‚îî‚îÄ Mark as ready
  ‚Üì
Frontend detects ready
  ‚Üì
Fetch AI result
  ‚Üì
Display:
  ‚îú‚îÄ Overall band score
  ‚îú‚îÄ Criteria scores (4 bars)
  ‚îú‚îÄ Strengths/Weaknesses
  ‚îú‚îÄ Detailed feedback per task
  ‚îú‚îÄ Highlighted errors in text
  ‚îî‚îÄ Sample essays
  ‚Üì
[Student reviews feedback]
  ‚îú‚îÄ Read overall feedback
  ‚îú‚îÄ Check criteria scores
  ‚îú‚îÄ Review highlighted errors
  ‚îî‚îÄ Compare with sample essays
  ‚Üì
[Student chooses action]
  ‚îú‚îÄ Save result
  ‚îú‚îÄ Download PDF
  ‚îî‚îÄ Practice again
  ‚Üì
[End] Writing practice complete with AI feedback
```

---

## 5. Sequence Diagrams

### 5.1. Submit Exercise Sequence (Reading/Listening)

```
Student      Frontend      API Server     Database      Grading Engine
  |              |              |              |                |
  |--Fill answers>              |              |                |
  |              |              |              |                |
  |--Click Submit>              |              |                |
  |              |              |              |                |
  |              |--Confirm---->|              |                |
  |              |  modal       |              |                |
  |              |              |              |                |
  |<--Confirm----|              |              |                |
  |              |              |              |                |
  |              |--POST /submit>             |                |
  |              |              |              |                |
  |              |              |--Save submission------------->|
  |              |              |              |                |
  |              |              |<--Submission saved            |
  |              |              |              |                |
  |              |              |--Grade------>|                |
  |              |              |(compare answers)              |
  |              |              |              |                |
  |              |              |<--Scores-----|                |
  |              |              |              |                |
  |              |              |--Update submission---------->|
  |              |              |(save scores) |                |
  |              |              |              |                |
  |              |              |--Update user stats---------->|
  |              |              |              |                |
  |              |              |--Check badges--------------->|
  |              |              |(unlock if achieved)          |
  |              |              |              |                |
  |              |<--200 OK-----|              |                |
  |              | + result_id  |              |                |
  |              |              |              |                |
  |<--Navigate---|              |              |                |
  |   to Result  |              |              |                |
  |              |              |              |                |
  |              |--GET /result/{id}---------->|                |
  |              |              |              |                |
  |              |              |<--Result data-                |
  |              |              |              |                |
  |              |<--200 OK-----|              |                |
  |              | + full result|              |                |
  |              |              |              |                |
  |<--Display----|              |              |                |
  |   result     |              |              |                |
  |              |              |              |                |
```

### 5.2. AI Grading Sequence (Writing/Speaking)

```
Student    Frontend    API Server    Database    AI Service    Queue
  |           |            |             |             |           |
  |--Submit-->|            |             |             |           |
  |  writing  |            |             |             |           |
  |           |            |             |             |           |
  |           |--POST /submit            |             |           |
  |           |            |             |             |           |
  |           |            |--Save submission-------->  |           |
  |           |            |             |             |           |
  |           |            |<--Submission saved        |           |
  |           |            |             |             |           |
  |           |            |--Queue for AI grading---->|---------->|
  |           |            |             |             |           |
  |           |            |             |             |           | Add to queue
  |           |            |             |             |           |
  |           |<--202 Accepted           |             |           |
  |           | submission_id            |             |           |
  |           | status: pending          |             |           |
  |           |            |             |             |           |
  |<--Navigate|            |             |             |           |
  |  to Result|            |             |             |           |
  |           |            |             |             |           |
  |<--Show----|            |             |             |           |
  |  loading  |            |             |             |           |
  |           |            |             |             |           |
  |           |            |             |             |<----------|
  |           |            |             |             | Process job
  |           |            |             |             |           |
  |           |            |             |             |--Call OpenAI API
  |           |            |             |             |           |
  |           |            |             |             |<--AI Response
  |           |            |             |             |(scores + feedback)
  |           |            |             |             |           |
  |           |            |             |<------------|           |
  |           |            |             | Save AI result          |
  |           |            |             |             |           |
  |           |            |             |------------>|           |
  |           |            |             | Update submission       |
  |           |            |             | status: graded          |
  |           |            |             |             |           |
  |           |--Poll: GET /result/{id}->|             |           |
  |           | (every 5s) |             |             |           |
  |           |            |             |             |           |
  |           |            |<--Status: pending         |           |
  |           |            |             |             |           |
  |           |<--Pending--|             |             |           |
  |           |            |             |             |           |
  |           |--Poll again|             |             |           |
  |           |            |             |             |           |
  |           |            |<--Status: graded          |           |
  |           |            | + AI feedback|             |           |
  |           |            |             |             |           |
  |           |<--200 OK---|             |             |           |
  |           | + full result            |             |           |
  |           |            |             |             |           |
  |<--Display-|            |             |             |           |
  |  AI result|            |             |             |           |
  |           |            |             |             |           |
```

---

## 6. Database Design

### 6.1. Table: exercises

**M√¥ t·∫£**: L∆∞u th√¥ng tin b√†i t·∫≠p

```sql
CREATE TABLE exercises (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  title VARCHAR(255) NOT NULL,
  description TEXT,
  skill VARCHAR(20) NOT NULL,
    -- 'reading' | 'listening' | 'writing' | 'speaking'
  type VARCHAR(20) NOT NULL,
    -- 'part' | 'fulltest'
  level VARCHAR(10) NOT NULL,
    -- 'A2' | 'B1' | 'B2' | 'C1'
  difficulty VARCHAR(20),
    -- 'easy' | 'medium' | 'hard'
  
  -- Structure
  parts INTEGER[],
    -- [1, 2, 3] - which parts included
  total_questions INTEGER NOT NULL,
  time_limit INTEGER,
    -- Minutes
  
  -- Content (JSONB for flexibility)
  content JSONB NOT NULL,
    -- Reading: passages + questions
    -- Listening: audio_urls + questions
    -- Writing: tasks
    -- Speaking: prompts
  
  -- Answers (for auto-grading)
  answer_key JSONB,
    -- Reading/Listening: correct answers
    -- Writing/Speaking: rubric
  
  -- Metadata
  created_by UUID REFERENCES users(id),
  is_active BOOLEAN DEFAULT TRUE,
  is_public BOOLEAN DEFAULT TRUE,
  tags TEXT[],
  
  -- Stats
  total_attempts INTEGER DEFAULT 0,
  average_score DECIMAL(5,2),
  
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP
);

-- Indexes
CREATE INDEX idx_exercises_skill ON exercises(skill);
CREATE INDEX idx_exercises_type ON exercises(type);
CREATE INDEX idx_exercises_level ON exercises(level);
CREATE INDEX idx_exercises_difficulty ON exercises(difficulty);
CREATE INDEX idx_exercises_is_active ON exercises(is_active);
CREATE INDEX idx_exercises_created_at ON exercises(created_at DESC);
```

**Example content JSONB**:

**Reading**:
```json
{
  "parts": [
    {
      "partNumber": 1,
      "type": "gap-fill",
      "passage": "Text with [1], [2], [3] gaps...",
      "questions": [
        {
          "questionNumber": 1,
          "options": ["A", "B", "C", "D"],
          "correctAnswer": "B"
        }
      ]
    }
  ]
}
```

**Listening**:
```json
{
  "parts": [
    {
      "partNumber": 1,
      "audioUrl": "https://cdn.../audio1.mp3",
      "transcript": "Full transcript...",
      "questions": [
        {
          "questionNumber": 1,
          "questionText": "What is the man's problem?",
          "options": ["A", "B", "C", "D"],
          "correctAnswer": "C"
        }
      ]
    }
  ]
}
```

**Writing**:
```json
{
  "tasks": [
    {
      "taskNumber": 1,
      "type": "email",
      "prompt": "Write an email to...",
      "minWords": 120,
      "timeLimit": 20
    },
    {
      "taskNumber": 2,
      "type": "essay",
      "prompt": "Some people think...",
      "minWords": 250,
      "timeLimit": 40
    }
  ]
}
```

**Speaking**:
```json
{
  "parts": [
    {
      "partNumber": 1,
      "type": "interview",
      "questions": [
        "Tell me about yourself.",
        "What do you do?"
      ],
      "timeLimit": 3
    },
    {
      "partNumber": 2,
      "type": "long-turn",
      "topic": "Describe a place...",
      "points": ["Where", "When", "What", "Why"],
      "prepTime": 1,
      "speakTime": 2
    }
  ]
}
```

---

### 6.2. Table: exercise_submissions

**M√¥ t·∫£**: L∆∞u b√†i l√†m c·ªßa h·ªçc vi√™n

```sql
CREATE TABLE exercise_submissions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  exercise_id UUID NOT NULL REFERENCES exercises(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  
  -- Submission data
  answers JSONB NOT NULL,
    -- User's answers
  status VARCHAR(20) DEFAULT 'in_progress',
    -- 'in_progress' | 'submitted' | 'graded'
  
  -- Timing
  started_at TIMESTAMP DEFAULT NOW(),
  submitted_at TIMESTAMP,
  time_taken INTEGER,
    -- Seconds
  
  -- Scoring (for Reading/Listening)
  score DECIMAL(5,2),
    -- 0-10 scale
  percentage DECIMAL(5,2),
    -- 0-100
  correct_count INTEGER,
  total_questions INTEGER,
  
  -- AI Grading (for Writing/Speaking)
  ai_grading_status VARCHAR(20),
    -- 'pending' | 'processing' | 'completed' | 'failed'
  ai_scores JSONB,
    -- Criteria scores
  ai_feedback JSONB,
    -- Detailed feedback
  ai_graded_at TIMESTAMP,
  
  -- Review data
  bookmarked_questions INTEGER[],
  notes JSONB,
    -- { questionId: "note text" }
  
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_submissions_exercise_id ON exercise_submissions(exercise_id);
CREATE INDEX idx_submissions_user_id ON exercise_submissions(user_id);
CREATE INDEX idx_submissions_status ON exercise_submissions(status);
CREATE INDEX idx_submissions_submitted_at ON exercise_submissions(submitted_at DESC);
CREATE INDEX idx_submissions_ai_status ON exercise_submissions(ai_grading_status);
```

**Example answers JSONB**:

**Reading/Listening**:
```json
{
  "1": "B",
  "2": "A",
  "3": "C",
  ...
  "40": "D"
}
```

**Writing**:
```json
{
  "task1": "Dear John,\nThank you for your email...",
  "task2": "Education is one of the most important..."
}
```

**Speaking**:
```json
{
  "part1": {
    "question1": {
      "audioUrl": "https://cdn.../recording1.mp3",
      "duration": 45
    }
  },
  "part2": {
    "audioUrl": "https://cdn.../recording2.mp3",
    "duration": 120
  }
}
```

**Example ai_scores JSONB (Writing)**:
```json
{
  "overall": 7.5,
  "taskAchievement": 7.5,
  "coherenceCohesion": 8.0,
  "lexicalResource": 7.0,
  "grammaticalAccuracy": 7.5
}
```

**Example ai_feedback JSONB**:
```json
{
  "overall": "Good essay with clear arguments...",
  "strengths": [
    "Good use of paragraphing",
    "Wide range of vocabulary"
  ],
  "weaknesses": [
    "Some grammatical errors",
    "Limited cohesive devices"
  ],
  "task1Feedback": "...",
  "task2Feedback": "...",
  "suggestions": [
    {
      "type": "grammar",
      "position": 123,
      "original": "very good",
      "suggestion": "excellent"
    }
  ]
}
```

---

### 6.3. Table: user_practice_stats

**M√¥ t·∫£**: L∆∞u th·ªëng k√™ luy·ªán t·∫≠p c·ªßa user

```sql
CREATE TABLE user_practice_stats (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  skill VARCHAR(20) NOT NULL,
    -- 'reading' | 'listening' | 'writing' | 'speaking'
  
  -- Counts
  total_exercises INTEGER DEFAULT 0,
  completed_exercises INTEGER DEFAULT 0,
  in_progress_exercises INTEGER DEFAULT 0,
  
  -- Scores
  average_score DECIMAL(5,2),
  highest_score DECIMAL(5,2),
  lowest_score DECIMAL(5,2),
  
  -- Time
  total_practice_time INTEGER DEFAULT 0,
    -- Seconds
  
  -- Level progression
  current_level VARCHAR(10),
    -- Estimated level based on performance
  
  -- Last activity
  last_practiced_at TIMESTAMP,
  
  updated_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(user_id, skill)
);

-- Indexes
CREATE INDEX idx_practice_stats_user_id ON user_practice_stats(user_id);
CREATE INDEX idx_practice_stats_skill ON user_practice_stats(skill);
```

---

### 6.4. Table: question_bookmarks

**M√¥ t·∫£**: L∆∞u c√¢u h·ªèi ƒë∆∞·ª£c bookmark

```sql
CREATE TABLE question_bookmarks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  exercise_id UUID NOT NULL REFERENCES exercises(id) ON DELETE CASCADE,
  question_number INTEGER NOT NULL,
  skill VARCHAR(20) NOT NULL,
  note TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(user_id, exercise_id, question_number)
);

-- Indexes
CREATE INDEX idx_bookmarks_user_id ON question_bookmarks(user_id);
CREATE INDEX idx_bookmarks_skill ON question_bookmarks(skill);
```

---

## 7. API Endpoints

### 7.1. GET /api/exercises

**M√¥ t·∫£**: L·∫•y danh s√°ch b√†i t·∫≠p

**Request**:
```typescript
GET /api/exercises?skill=reading&type=fulltest&level=B2&page=1&limit=20
Authorization: Bearer {token}
```

**Query Parameters**:
- `skill`: Required ('reading'|'listening'|'writing'|'speaking')
- `type`: Optional ('part'|'fulltest')
- `parts`: Optional (comma-separated, e.g., "1,2")
- `level`: Optional ('A2'|'B1'|'B2'|'C1')
- `difficulty`: Optional ('easy'|'medium'|'hard')
- `status`: Optional ('not_started'|'in_progress'|'completed')
- `sort`: Optional ('newest'|'oldest'|'easy_hard'|'hard_easy')
- `search`: Optional (search in title)
- `page`: Optional (default: 1)
- `limit`: Optional (default: 20, max: 100)

**Response** (200):
```json
{
  "success": true,
  "data": {
    "exercises": [
      {
        "id": "uuid",
        "title": "Reading Full Test - ƒê·ªÅ s·ªë 1",
        "description": "B√†i thi th·ª≠ Reading ƒë·∫ßy ƒë·ªß theo chu·∫©n VSTEP",
        "skill": "reading",
        "type": "fulltest",
        "level": "B2",
        "difficulty": "medium",
        "parts": [1, 2, 3],
        "totalQuestions": 40,
        "timeLimit": 60,
        "userStatus": {
          "status": "completed",
          "lastAttempt": {
            "submissionId": "uuid",
            "score": 8.5,
            "submittedAt": "2024-12-14T10:30:00Z"
          }
        },
        "stats": {
          "totalAttempts": 1234,
          "averageScore": 7.2
        }
      }
      // ... more exercises
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 45,
      "pages": 3
    }
  }
}
```

---

### 7.2. GET /api/exercises/:id

**M√¥ t·∫£**: L·∫•y chi ti·∫øt b√†i t·∫≠p

**Request**:
```typescript
GET /api/exercises/uuid-exercise-id
Authorization: Bearer {token}
```

**Response** (200):
```json
{
  "success": true,
  "data": {
    "exercise": {
      "id": "uuid",
      "title": "Reading Full Test - ƒê·ªÅ s·ªë 1",
      "skill": "reading",
      "type": "fulltest",
      "level": "B2",
      "parts": [1, 2, 3],
      "totalQuestions": 40,
      "timeLimit": 60,
      "content": {
        "parts": [
          {
            "partNumber": 1,
            "type": "gap-fill",
            "passage": "Full passage text...",
            "questions": [
              {
                "questionNumber": 1,
                "questionText": "Question 1?",
                "options": ["A", "B", "C", "D"]
              }
              // ... more questions
            ]
          }
          // ... more parts
        ]
      },
      "userProgress": {
        "hasProgress": true,
        "submissionId": "uuid",
        "status": "in_progress",
        "answers": {"1": "B", "2": "A"},
        "timeRemaining": 3245,
        "startedAt": "2024-12-15T09:00:00Z"
      }
    }
  }
}
```

**Notes**:
- `content` includes full exercise data
- `answer_key` is NOT returned (only after submission)
- `userProgress` shows if user has in-progress submission

---

### 7.3. POST /api/exercises/:id/start

**M√¥ t·∫£**: B·∫Øt ƒë·∫ßu l√†m b√†i t·∫≠p (t·∫°o submission)

**Request**:
```typescript
POST /api/exercises/uuid-exercise-id/start
Authorization: Bearer {token}
Content-Type: application/json

{
  "timerEnabled": true
}
```

**Response** (201):
```json
{
  "success": true,
  "data": {
    "submissionId": "uuid",
    "exerciseId": "uuid",
    "status": "in_progress",
    "startedAt": "2024-12-15T10:00:00Z",
    "timeRemaining": 3600
  }
}
```

**Business Logic**:
1. Check if user already has in-progress submission
   - Yes: Return existing submission
   - No: Create new submission
2. Set status = 'in_progress'
3. Set started_at = NOW()
4. Return submission_id

---

### 7.4. PUT /api/submissions/:id/save

**M√¥ t·∫£**: L∆∞u ti·∫øn tr√¨nh (auto-save)

**Request**:
```typescript
PUT /api/submissions/uuid-submission-id/save
Authorization: Bearer {token}
Content-Type: application/json

{
  "answers": {
    "1": "B",
    "2": "A",
    "3": "C"
  },
  "bookmarkedQuestions": [5, 12, 18],
  "notes": {
    "5": "Difficult question about main idea"
  },
  "timeRemaining": 3245
}
```

**Response** (200):
```json
{
  "success": true,
  "message": "Progress saved",
  "savedAt": "2024-12-15T10:05:30Z"
}
```

**Business Logic**:
1. Validate submission belongs to user
2. Update answers (merge with existing)
3. Update bookmarks and notes
4. Update time_remaining
5. Set updated_at = NOW()
6. Return success

---

### 7.5. POST /api/submissions/:id/submit

**M√¥ t·∫£**: N·ªôp b√†i (final submit)

**Request**:
```typescript
POST /api/submissions/uuid-submission-id/submit
Authorization: Bearer {token}
Content-Type: application/json

{
  "answers": {
    "1": "B",
    "2": "A",
    ...
    "40": "D"
  },
  "timeTaken": 3245
}
```

**Response** (200 - for Reading/Listening):
```json
{
  "success": true,
  "message": "B√†i t·∫≠p ƒë√£ ƒë∆∞·ª£c n·ªôp th√†nh c√¥ng",
  "data": {
    "submissionId": "uuid",
    "status": "graded",
    "score": 8.5,
    "percentage": 85.0,
    "correctCount": 34,
    "totalQuestions": 40,
    "timeTaken": 3245,
    "submittedAt": "2024-12-15T10:54:05Z"
  }
}
```

**Response** (202 - for Writing/Speaking):
```json
{
  "success": true,
  "message": "B√†i t·∫≠p ƒë√£ ƒë∆∞·ª£c n·ªôp. ƒêang ch·ªù ch·∫•m AI.",
  "data": {
    "submissionId": "uuid",
    "status": "submitted",
    "aiGradingStatus": "pending",
    "submittedAt": "2024-12-15T10:54:05Z",
    "estimatedGradingTime": "30-60 seconds"
  }
}
```

**Business Logic**:
1. Validate submission belongs to user
2. Check status is 'in_progress'
3. Update answers (final)
4. Set status = 'submitted'
5. Set submitted_at = NOW()
6. Calculate time_taken
7. **For Reading/Listening**:
   - Auto-grade immediately
   - Compare answers with answer_key
   - Calculate score
   - Set status = 'graded'
   - Return scores
8. **For Writing/Speaking**:
   - Queue for AI grading
   - Set ai_grading_status = 'pending'
   - Return 202 Accepted
   - Process AI grading async
9. Update user_practice_stats
10. Check and unlock badges

---

### 7.6. GET /api/submissions/:id/result

**M√¥ t·∫£**: L·∫•y k·∫øt qu·∫£ b√†i l√†m

**Request**:
```typescript
GET /api/submissions/uuid-submission-id/result
Authorization: Bearer {token}
```

**Response** (200 - Reading/Listening):
```json
{
  "success": true,
  "data": {
    "submission": {
      "id": "uuid",
      "exerciseId": "uuid",
      "exerciseTitle": "Reading Full Test - ƒê·ªÅ s·ªë 1",
      "skill": "reading",
      "status": "graded",
      "score": 8.5,
      "percentage": 85.0,
      "correctCount": 34,
      "totalQuestions": 40,
      "timeTaken": 3245,
      "submittedAt": "2024-12-15T10:54:05Z"
    },
    "breakdown": {
      "byPart": [
        {
          "partNumber": 1,
          "score": 9.0,
          "correctCount": 9,
          "totalQuestions": 10
        },
        {
          "partNumber": 2,
          "score": 8.0,
          "correctCount": 8,
          "totalQuestions": 10
        },
        {
          "partNumber": 3,
          "score": 8.5,
          "correctCount": 17,
          "totalQuestions": 20
        }
      ]
    },
    "questions": [
      {
        "questionNumber": 1,
        "questionText": "Question 1 text",
        "userAnswer": "B",
        "correctAnswer": "B",
        "isCorrect": true,
        "explanation": "ƒê√°p √°n ƒë√∫ng l√† B v√¨..."
      },
      {
        "questionNumber": 2,
        "questionText": "Question 2 text",
        "userAnswer": "A",
        "correctAnswer": "C",
        "isCorrect": false,
        "explanation": "ƒê√°p √°n ƒë√∫ng l√† C v√¨..."
      }
      // ... all questions
    ],
    "analysis": {
      "strengths": ["Part 1 - ƒêi·ªÅn t·ª´ v√†o ch·ªó tr·ªëng"],
      "weaknesses": ["Part 2 - ƒê·ªçc ƒëo·∫°n vƒÉn ng·∫Øn"]
    }
  }
}
```

**Response** (200 - Writing/Speaking with AI):
```json
{
  "success": true,
  "data": {
    "submission": {
      "id": "uuid",
      "exerciseTitle": "Writing Full Test - ƒê·ªÅ s·ªë 1",
      "skill": "writing",
      "status": "graded",
      "aiGradingStatus": "completed",
      "submittedAt": "2024-12-15T10:54:05Z",
      "aiGradedAt": "2024-12-15T10:55:23Z"
    },
    "scores": {
      "overall": 7.5,
      "taskAchievement": 7.5,
      "coherenceCohesion": 8.0,
      "lexicalResource": 7.0,
      "grammaticalAccuracy": 7.5
    },
    "feedback": {
      "overall": "Good essay overall with clear structure...",
      "strengths": [
        "Good use of paragraphing and organization",
        "Wide range of vocabulary related to the topic"
      ],
      "weaknesses": [
        "Some grammatical errors with complex sentences",
        "Limited use of cohesive devices"
      ],
      "task1Feedback": "Task 1 detailed feedback...",
      "task2Feedback": "Task 2 detailed feedback...",
      "suggestions": [
        {
          "type": "grammar",
          "position": 45,
          "original": "very good",
          "suggestion": "excellent",
          "explanation": "Use stronger adjectives"
        }
      ]
    },
    "userWriting": {
      "task1": "User's task 1 text...",
      "task2": "User's task 2 text..."
    },
    "sampleEssays": [
      {
        "title": "Sample Essay - Band 7.5",
        "content": "Full sample essay...",
        "annotations": [...]
      }
    ]
  }
}
```

**Response** (202 - AI Grading in progress):
```json
{
  "success": true,
  "data": {
    "submission": {
      "id": "uuid",
      "status": "submitted",
      "aiGradingStatus": "processing",
      "submittedAt": "2024-12-15T10:54:05Z",
      "estimatedTimeRemaining": "20 seconds"
    }
  }
}
```

**Business Logic**:
1. Validate submission belongs to user
2. Check status:
   - 'in_progress' ‚Üí Error: Not submitted yet
   - 'submitted' ‚Üí Check AI grading status
     - 'pending' or 'processing' ‚Üí Return 202
     - 'completed' ‚Üí Return full result
     - 'failed' ‚Üí Return error + option to retry
   - 'graded' ‚Üí Return full result
3. For Reading/Listening: Return immediate results
4. For Writing/Speaking: Check AI grading status

---

### 7.7. POST /api/ai-grading/grade

**M√¥ t·∫£**: Trigger AI grading (called by backend worker)

**Request** (Internal):
```typescript
POST /api/ai-grading/grade
Content-Type: application/json

{
  "submissionId": "uuid",
  "skill": "writing",
  "content": {
    "task1": "User's task 1...",
    "task2": "User's task 2..."
  },
  "rubric": {
    // Grading criteria
  }
}
```

**Response** (200):
```json
{
  "success": true,
  "data": {
    "submissionId": "uuid",
    "scores": {
      "overall": 7.5,
      "taskAchievement": 7.5,
      "coherenceCohesion": 8.0,
      "lexicalResource": 7.0,
      "grammaticalAccuracy": 7.5
    },
    "feedback": {
      // Detailed feedback
    }
  }
}
```

**Business Logic**:
1. Validate submission exists
2. Call OpenAI API v·ªõi prompt:
   - System: "You are a VSTEP Writing grader..."
   - User: Exercise prompt + User's writing
   - Format: JSON with scores + feedback
3. Parse AI response
4. Validate scores (0-10 range)
5. Update submission:
   - ai_scores
   - ai_feedback
   - ai_grading_status = 'completed'
   - ai_graded_at = NOW()
6. Send notification to user
7. Return results

---

### 7.8. GET /api/history

**M√¥ t·∫£**: L·∫•y l·ªãch s·ª≠ l√†m b√†i

**Request**:
```typescript
GET /api/history?skill=reading&status=completed&sort=recent&page=1&limit=20
Authorization: Bearer {token}
```

**Query Parameters**:
- `skill`: Optional ('reading'|'listening'|'writing'|'speaking')
- `type`: Optional ('part'|'fulltest')
- `status`: Optional ('in_progress'|'submitted'|'graded')
- `dateFrom`: Optional (ISO date)
- `dateTo`: Optional (ISO date)
- `scoreMin`: Optional (0-10)
- `scoreMax`: Optional (0-10)
- `sort`: Optional ('recent'|'oldest'|'score_high'|'score_low')
- `page`: Optional (default: 1)
- `limit`: Optional (default: 20)

**Response** (200):
```json
{
  "success": true,
  "data": {
    "history": [
      {
        "submissionId": "uuid",
        "exerciseId": "uuid",
        "exerciseTitle": "Reading Full Test - ƒê·ªÅ s·ªë 1",
        "skill": "reading",
        "type": "fulltest",
        "level": "B2",
        "status": "graded",
        "score": 8.5,
        "percentage": 85.0,
        "timeTaken": 3245,
        "submittedAt": "2024-12-15T10:54:05Z"
      }
      // ... more submissions
    ],
    "stats": {
      "total": 45,
      "completed": 42,
      "inProgress": 3
    },
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 45,
      "pages": 3
    }
  }
}
```

---

## 8. Business Rules

### 8.1. Exercise Rules

**Exercise Availability**:
- Public exercises: Available to all users
- Private exercises: Only creator and assigned users
- Level-based filtering: Recommend matching user's level

**Time Limit**:
- Standard: Follow VSTEP guidelines
  - Reading Full Test: 60 minutes
  - Listening Full Test: 40 minutes
  - Writing Full Test: 60 minutes
  - Speaking Full Test: 12 minutes
- Practice mode: Can disable timer
- Custom: Teacher can set custom time

---

### 8.2. Submission Rules

**One Active Submission**:
- User can only have 1 in-progress submission per exercise
- Starting new attempt will save current progress
- Option to continue or start fresh

**Auto-save Frequency**:
- Client-side: Every 10 seconds to localStorage
- Server-side: Every 30 seconds via API
- On page unload: Save immediately

**Submit Validation**:
- Must answer all questions (or confirm to skip)
- Cannot submit without starting
- Cannot submit twice (status check)

---

### 8.3. Scoring Rules

**Reading/Listening** (Auto-grading):
- Exact match with answer key
- Score = (Correct / Total) √ó 10
- Band score mapping:
  - 0-3.9: Band 3
  - 4.0-4.9: Band 4
  - 5.0-5.9: Band 5
  - 6.0-6.9: Band 6
  - 7.0-7.9: Band 7
  - 8.0-8.9: Band 8
  - 9.0-10: Band 9-10

**Writing/Speaking** (AI-grading):
- 4 criteria scored 0-10 each
- Overall = Average of 4 criteria
- Criteria:
  1. Task Achievement/Response
  2. Coherence and Cohesion
  3. Lexical Resource
  4. Grammatical Range and Accuracy
  5. (Speaking only) Pronunciation and Fluency

**Score Rounding**:
- Round to 1 decimal place (e.g., 7.3, 8.5)

---

### 8.4. AI Grading Rules

**Grading Time**:
- Estimated: 30-60 seconds for Writing
- Estimated: 1-2 minutes for Speaking
- Max wait: 5 minutes ‚Üí Retry

**Retry Policy**:
- Failed grading: Auto-retry 3 times
- After 3 fails: Mark as failed
- User can request manual grading

**Feedback Quality**:
- Must include scores for all criteria
- Must include strengths (‚â•2 points)
- Must include weaknesses (‚â•2 points)
- Must include specific suggestions (‚â•3 examples)

---

### 8.5. Bookmark Rules

**Limit**:
- Max 100 bookmarks per user
- Auto-remove oldest if exceeds

**Access**:
- Can bookmark during exercise
- Can view all bookmarks from "My Bookmarks" page
- Can add notes to bookmarks

---

## K·∫øt th√∫c Module Practice & Learning

Module n√†y l√† trung t√¢m c·ªßa VSTEPRO, t√≠ch h·ª£p v·ªõi:
- Module 03: Exam System (Thi th·ª≠)
- Module 04: Grading System (Ch·∫•m ƒëi·ªÉm)
- Module 07: Assignment Management (B√†i t·∫≠p ƒë∆∞·ª£c giao)
- Module 12: Achievements (Badges khi ho√†n th√†nh)
- Module 19: Statistics (Th·ªëng k√™ ti·∫øn ƒë·ªô)
- Module 20: Notification (Th√¥ng b√°o k·∫øt qu·∫£)
