import { DataSource } from 'typeorm';
import { Role } from '../../../modules/users/entities/role.entity';

export const ROLE_IDS = {
  STUDENT: '550e8400-e29b-41d4-a716-446655440001',
  TEACHER: '550e8400-e29b-41d4-a716-446655440002',
  ADMIN: '550e8400-e29b-41d4-a716-446655440003',
  UPLOADER: '550e8400-e29b-41d4-a716-446655440004',
};

export const rolesData: Partial<Role>[] = [
  {
    id: ROLE_IDS.STUDENT,
    name: 'student',
    displayName: 'H·ªçc vi√™n',
    description: 'Vai tr√≤ h·ªçc vi√™n - c√≥ th·ªÉ l√†m b√†i t·∫≠p, thi th·ª≠, xem l·ªãch s·ª≠ v√† th·ªëng k√™ h·ªçc t·∫≠p',
    permissions: [
      'practice.reading',
      'practice.listening',
      'practice.writing',
      'practice.speaking',
      'exam.take',
      'exam.mock',
      'exam.virtual',
      'history.view',
      'statistics.view',
      'documents.view',
      'documents.download',
      'assignments.view',
      'assignments.submit',
      'ai-assistant.chat',
      'ai-grading.submit',
      'profile.view',
      'profile.edit',
      'notifications.view',
      'goals.view',
      'goals.create',
      'blog.read',
      'messages.send',
      'messages.receive',
    ],
    isActive: true,
  },
  {
    id: ROLE_IDS.TEACHER,
    name: 'teacher',
    displayName: 'Gi√°o vi√™n',
    description: 'Vai tr√≤ gi√°o vi√™n - c√≥ th·ªÉ giao b√†i t·∫≠p, ch·∫•m b√†i, qu·∫£n l√Ω l·ªõp h·ªçc v√† theo d√µi ti·∫øn ƒë·ªô h·ªçc sinh',
    permissions: [
      'practice.reading',
      'practice.listening',
      'practice.writing',
      'practice.speaking',
      'exam.take',
      'exam.mock',
      'exam.virtual',
      'history.view',
      'statistics.view',
      'documents.view',
      'documents.download',
      'documents.upload',
      'assignments.view',
      'assignments.create',
      'assignments.assign',
      'assignments.grade',
      'assignments.feedback',
      'class.view',
      'class.create',
      'class.manage',
      'class.attendance',
      'students.view',
      'students.progress',
      'goals.view',
      'goals.create',
      'goals.assign',
      'ai-assistant.chat',
      'ai-grading.review',
      'profile.view',
      'profile.edit',
      'notifications.view',
      'notifications.send',
      'blog.read',
      'blog.write',
      'messages.send',
      'messages.receive',
      'reports.generate',
      'reports.export',
    ],
    isActive: true,
  },
  {
    id: ROLE_IDS.ADMIN,
    name: 'admin',
    displayName: 'Qu·∫£n tr·ªã vi√™n',
    description: 'Vai tr√≤ qu·∫£n tr·ªã vi√™n - c√≥ to√†n quy·ªÅn qu·∫£n l√Ω h·ªá th·ªëng, ng∆∞·ªùi d√πng v√† n·ªôi dung',
    permissions: [
      'practice.reading',
      'practice.listening',
      'practice.writing',
      'practice.speaking',
      'exam.take',
      'exam.mock',
      'exam.virtual',
      'history.view',
      'statistics.view',
      'statistics.all',
      'documents.view',
      'documents.download',
      'documents.upload',
      'documents.manage',
      'documents.delete',
      'assignments.view',
      'assignments.create',
      'assignments.assign',
      'assignments.grade',
      'assignments.manage',
      'assignments.delete',
      'class.view',
      'class.create',
      'class.manage',
      'class.delete',
      'class.attendance',
      'users.view',
      'users.create',
      'users.edit',
      'users.delete',
      'users.ban',
      'roles.view',
      'roles.assign',
      'students.view',
      'students.progress',
      'teachers.view',
      'teachers.manage',
      'goals.view',
      'goals.create',
      'goals.assign',
      'goals.delete',
      'ai-assistant.chat',
      'ai-assistant.configure',
      'ai-grading.review',
      'ai-grading.configure',
      'profile.view',
      'profile.edit',
      'notifications.view',
      'notifications.send',
      'notifications.broadcast',
      'blog.read',
      'blog.write',
      'blog.edit',
      'blog.delete',
      'blog.publish',
      'messages.send',
      'messages.receive',
      'messages.moderate',
      'reports.generate',
      'reports.export',
      'reports.all',
      'system.settings',
      'system.backup',
      'system.logs',
      'analytics.view',
    ],
    isActive: true,
  },
  {
    id: ROLE_IDS.UPLOADER,
    name: 'uploader',
    displayName: 'Ng∆∞·ªùi t·∫£i l√™n',
    description: 'Vai tr√≤ ng∆∞·ªùi t·∫£i l√™n - chuy√™n tr√°ch upload v√† qu·∫£n l√Ω ƒë·ªÅ thi, t√†i li·ªáu h·ªçc t·∫≠p',
    permissions: [
      'practice.reading',
      'practice.listening',
      'practice.writing',
      'practice.speaking',
      'exam.take',
      'exam.mock',
      'exam.virtual',
      'history.view',
      'statistics.view',
      'documents.view',
      'documents.download',
      'documents.upload',
      'documents.manage',
      'documents.categorize',
      'exercises.upload',
      'exercises.edit',
      'exercises.manage',
      'exams.upload',
      'exams.edit',
      'exams.manage',
      'materials.upload',
      'materials.edit',
      'materials.manage',
      'audio.upload',
      'audio.manage',
      'images.upload',
      'images.manage',
      'ai-assistant.chat',
      'profile.view',
      'profile.edit',
      'notifications.view',
      'blog.read',
      'messages.send',
      'messages.receive',
      'reports.content',
    ],
    isActive: true,
  },
];

export async function seedRoles(dataSource: DataSource): Promise<void> {
  const roleRepo = dataSource.getRepository(Role);

  for (const roleData of rolesData) {
    const existing = await roleRepo.findOne({ where: { id: roleData.id } });
    
    if (!existing) {
      await roleRepo.save(roleRepo.create(roleData));
      console.log(`‚úÖ Created role: ${roleData.name}`);
    } else {
      // Update existing role with new permissions
      await roleRepo.update(existing.id, roleData);
      console.log(`üîÑ Updated role: ${roleData.name}`);
    }
  }

  console.log('üéâ Roles seeding completed!');
}
